<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVHS Schedule Search</title>
</head>
<body>
    <h1>Schedules</h1>
    <div>
        <select id="subject">
            <option value="">--Select Subject--</option>
            <option value="Human Geography">Human Geography</option>
            <option value="Biology">Biology</option>
            <option value="Tech Theater">Tech Theater</option>
            <option value="English">English</option>
            <option value="PE">PE</option>
        </select>

        <label for="period">Select Period:</label>
        <input type="range" id="period" min="1" max="7" value="1">
        <span id="periodValue">1</span>

        <button id="fetchDataButton">Fetch Schedules</button>
    </div>

    <div id="results"></div>

    <script>
        document.getElementById("fetchDataButton").addEventListener("click", fetchSchedules);
        document.getElementById("period").addEventListener("input", function() {
            document.getElementById("periodValue").textContent = this.value;
        });

        async function fetchSchedules() {
            const apiUrl = 'https://sheets.livepolls.app/api/spreadsheets/8cb7bf77-7f2b-4992-8016-862a1b494530/Sheet1';

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                displaySchedules(data.data);
            } catch (error) {
                console.error('Fetch operation failed:', error.message);
            }
        }

        function displaySchedules(data) {
            const resultsContainer = document.getElementById("results");
            resultsContainer.innerHTML = ''; // Clear previous results

            const subject = document.getElementById("subject").value;
            const periodIndex = document.getElementById("period").value; // Get the selected period
            
            // Create the key for the selected period
            const periodKey = periodIndex === "1" ? "1st Period" :
                              periodIndex === "2" ? "2nd Period" :
                              periodIndex === "3" ? "3rd Period" :
                              `${periodIndex}th Period`;

            data.forEach(student => {
                const periodSubject = student[periodKey] || ""; // Access the subject for the selected period

                // Check if the student has the selected subject in the specified period
                if ((subject === "" || periodSubject === subject)) {
                    const card = document.createElement("div");
                    card.innerHTML = `<h3>${student.Name}</h3>`;
                    resultsContainer.appendChild(card);
                }
            });

            if (resultsContainer.innerHTML === '') {
                resultsContainer.innerHTML = '<p>No schedules found.</p>'; // Message when no results match
            }
        }
    </script>
</body>
</html>
