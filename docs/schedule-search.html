<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVHS Schedule Search</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="favicon.png" type="image/png">
    <style>
        .resources-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between; /* Adjusts spacing between cards */
        }
        .resource-card {
            flex: 0 0 calc(25% - 10px); /* Adjusts to fit 4 cards per row with some margin */
            margin: 5px; /* Adds some space between the cards */
            box-sizing: border-box; /* Ensures padding and margin are included in the width */
        }
        @media (max-width: 768px) {
            .resource-card {
                flex: 0 0 calc(50% - 10px); /* Adjusts to 2 cards per row on smaller screens */
            }
        }
        @media (max-width: 480px) {
            .resource-card {
                flex: 0 0 100%; /* Stacks cards on small screens */
            }
        }
      .iframe-container {
          width: 90%;
          height: 07vh; /* Adjust the height as needed */
          overflow: hidden;
          border-radius: 10px;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .iframe-container iframe {
          width: 90%;
          height: 80vh;
          border: none;
      }
    </style>

</head>
<body>
    <header class="glass-header">
        <div class="logo-container">
            <h1 class="glow-text">CVHS Schedule Search</h1>
        </div>
        <div id="nav-container"></div> <!-- Placeholder for navigation -->
    </header>
    
    <main class="fade-in">
        <h2 class="section-title glow-text">Schedules</h2>
        <div class="iframe-container">
            <center>
            <iframe src="https://docs.google.com/spreadsheets/d/1PCXDpvzGOsruoTfskIyDekMZMh0dBNAkYK9eGlAIUAQ/edit?gid=0#gid=0"></iframe>
            </center>
        </div>
    </main>
    <script>
        document.getElementById("fetchDataButton").addEventListener("click", fetchSchedules);
        document.getElementById("period").addEventListener("input", function() {
            document.getElementById("periodValue").textContent = this.value;
        });

        async function fetchSchedules() {
            const apiUrl = 'https://sheets.livepolls.app/api/spreadsheets/8cb7bf77-7f2b-4992-8016-862a1b494530/Sheet1';

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                displaySchedules(data.data);
            } catch (error) {
                console.error('Fetch operation failed:', error.message);
            }
        }

        function displaySchedules(data) {
            const resultsContainer = document.getElementById("results");
            resultsContainer.innerHTML = ''; // Clear previous results
        
            const subject = document.getElementById("subject").value;
            const periodIndex = document.getElementById("period").value; // Get the selected period
            
            // Create the key for the selected period
            const periodKey = periodIndex === "1" ? "1st Period" :
                              periodIndex === "2" ? "2nd Period" :
                              periodIndex === "3" ? "3rd Period" :
                              `${periodIndex}th Period`;
        
            // Create a grid container for the cards
            const gridContainer = document.createElement("div");
            gridContainer.className = "resources-grid";
        
            data.forEach(student => {
                const periodSubject = student[periodKey] || ""; // Access the subject for the selected period
        
                // Check if the student has the selected subject in the specified period
                if ((subject === "" || periodSubject === subject)) {
                    const card = document.createElement("div");
                    card.className = "resource-card glass-effect"; // Add the CSS classes for styling
                    card.innerHTML = `<h3 class="resource-title">${student.Name}</h3>`; // Set the inner HTML
                    gridContainer.appendChild(card); // Append the card to the grid container
                }
            });
        
            // Append the grid container to the results
            resultsContainer.appendChild(gridContainer);
        
            // If no results, show a message
            if (gridContainer.innerHTML === '') {
                resultsContainer.innerHTML = '<center><p><i>No schedules found.<i></p></center>'; // Message when no results match
            }
        }

        // Load navigation from nav.html
        async function loadNav() {
            try {
                const response = await fetch('navnav.html');
                const nav = await response.text();
                document.getElementById('nav-container').innerHTML = nav;
            } catch (error) {
                console.error('Error loading navigation:', error);
                document.getElementById('nav-container').innerHTML = '<p>Error loading navigation. Please try again later.</p>';
            }
        }

        // Fetch assignments and load navigation when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadNav();
            fetchAssignments();
        });
    </script>
</body>
</html>
